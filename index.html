<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>ã¾ãªã³ãƒ¼ï½œé”äººã®æŠ•ç¨¿ï¼ˆé–²è¦§ï¼‰</title>

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-JETCC9WWMR"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-JETCC9WWMR');
  </script>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root {
      --apple-bg: #F5F5F7;
      --apple-card: #FFFFFF;
      --apple-blue: #007AFF;
      --apple-text: #1D1D1F;
      --apple-secondary-text: #86868B;
      --apple-border: rgba(0,0,0,0.1);

      --radius-card: 20px;
      --shadow-card: 0 4px 12px rgba(0,0,0,0.03);
    }

    body {
      background-color: var(--apple-bg);
      color: var(--apple-text);
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Hiragino Kaku Gothic ProN", "Hiragino Sans", sans-serif;
      -webkit-font-smoothing: antialiased;
      line-height: 1.5;
    }

    .glass-header {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: saturate(180%) blur(20px);
      -webkit-backdrop-filter: saturate(180%) blur(20px);
      border-bottom: 0.5px solid var(--apple-border);
    }

    .card {
      background: var(--apple-card);
      border-radius: var(--radius-card);
      border: 0.5px solid var(--apple-border);
      box-shadow: var(--shadow-card);
      transition: transform 0.18s ease, box-shadow 0.18s ease, opacity 0.18s ease;
      -webkit-tap-highlight-color: transparent;
    }
    .card:active { transform: scale(0.99); opacity: 0.92; }

    .btn-primary {
      background-color: var(--apple-blue);
      color: white;
      border-radius: 12px;
      font-weight: 600;
      transition: opacity 0.2s, transform 0.2s;
      -webkit-tap-highlight-color: transparent;
    }
    .btn-primary:active { opacity: 0.8; transform: scale(0.99); }

    .chip {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 8px;
      font-size: 11px;
      font-weight: 600;
      margin-bottom: 4px;
      border: 0.5px solid rgba(0,0,0,0.05);
      -webkit-tap-highlight-color: transparent;
    }

    /* å±æ€§ / ãƒ•ãƒƒã‚¯ / å¼•ãè¾¼ã¿ / ã‚«ãƒ¼ãƒ‰èª¬æ˜ï¼šè‰²ã¯UIã«åˆã‚ã›ã¦ä¿æŒ */
    .chip-attribute { background: #E5E5EA; color: #3A3A3C; }
    .chip-hook { background: #FFF2E0; color: #FF9500; }
    .chip-pitch { background: #E4F9E2; color: #28CD41; }
    .chip-card { background: #E5F1FF; color: #007AFF; }

    .label-caps {
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--apple-secondary-text);
      margin-bottom: 6px;
      display: block;
    }

    .cta-link-icon {
      font-size: 12px;
      color: var(--apple-blue);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
      background: #F2F2F7;
      padding: 7px 12px;
      border-radius: 999px;
      border: 0.5px solid rgba(0,0,0,0.06);
      -webkit-tap-highlight-color: transparent;
      white-space: nowrap;
    }
    .cta-link-icon:active { transform: scale(0.99); opacity: 0.85; }

    details summary { list-style: none; outline: none; }
    details summary::-webkit-details-marker { display: none; }

    .summary-row{
      border-radius: 999px;
      padding: 10px 12px;
      background: #F2F2F7;
      border: 0.5px solid rgba(0,0,0,0.06);
      -webkit-tap-highlight-color: transparent;
      transition: opacity .18s, transform .18s;
    }
    .summary-row:active{ opacity: .85; transform: scale(0.99); }

    .helpful-pill{
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 0.5px solid rgba(0,0,0,0.08);
      background: #F2F2F7;
      transition: opacity .18s, transform .18s;
      -webkit-tap-highlight-color: transparent;
      white-space: nowrap;
    }
    .helpful-pill:active{ opacity: .85; transform: scale(0.99); }

    .hairline { border-top: 0.5px solid rgba(0,0,0,0.06); }

    @media (prefers-reduced-motion: reduce) {
      .card, .btn-primary, .cta-link-icon, .helpful-pill, .summary-row { transition: none; }
    }
  </style>
</head>

<body class="pb-20">

  <header class="sticky top-0 z-50 glass-header">
    <div class="max-w-md mx-auto px-5 py-3 flex items-center justify-between">
      <button class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 transition" aria-label="menu">
        <i class="fa-solid fa-bars text-lg text-gray-500"></i>
      </button>

      <div class="flex flex-col items-center">
        <span class="text-[10px] font-bold text-gray-400 tracking-[0.2em] uppercase">Learning App</span>
        <h1 class="text-base font-bold tracking-tight">ã¾ãªã³ãƒ¼</h1>
      </div>

      <div class="w-10 h-10 rounded-full overflow-hidden border border-gray-200">
        <img src="https://i.pravatar.cc/80?img=12" alt="avatar" />
      </div>
    </div>
  </header>

  <main id="app" class="max-w-md mx-auto px-5 pt-6">

    <section class="mb-4">
      <div class="card p-5">
        <span class="label-caps">Current Event</span>
        <div class="flex justify-between items-end">
          <h2 class="text-2xl font-extrabold tracking-tight">DECO*27</h2>
          <div class="text-right">
            <p class="text-[12px] font-bold text-blue-600">é–²è¦§ãƒšãƒ¼ã‚¸</p>
            <p class="text-[10px] text-gray-400">å˜èªãƒãƒƒãƒ—ã§ãƒˆãƒ¼ã‚¯ã‚’ãƒã‚¹ã‚¿ãƒ¼ã™ã‚‹</p>
          </div>
        </div>
      </div>
    </section>

    <section class="grid grid-cols-1 gap-3 mb-8">
      <a id="event-link" href="#" target="_blank" class="card p-4 flex items-center gap-4">
        <div class="w-12 h-12 rounded-2xl bg-blue-50 flex items-center justify-center text-blue-600">
          <i class="fa-solid fa-calendar-check text-xl"></i>
        </div>
        <div class="flex-1 min-w-0">
          <span class="label-caps">Event Info</span>
          <p class="text-sm font-bold">ä»Šå›ã®ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°</p>
          <span class="cta-link-icon mt-2">å…¬å¼ãƒšãƒ¼ã‚¸ã¸ <i class="fa-solid fa-chevron-right text-[10px]"></i></span>
        </div>
      </a>

      <a id="card-link" href="#" target="_blank" class="card p-4 flex items-center gap-4">
        <div class="w-12 h-12 rounded-2xl bg-orange-50 flex items-center justify-center text-orange-600">
          <i class="fa-regular fa-credit-card text-xl"></i>
        </div>
        <div class="flex-1 min-w-0">
          <span class="label-caps">Related Card</span>
          <p class="text-sm font-bold">é–¢é€£ã‚«ãƒ¼ãƒ‰</p>
          <p class="text-[11px] text-gray-500 mt-0.5 leading-tight">åŒã˜ãƒœãƒ¼ã‚«ãƒ­ã‚¤ãƒ‰ã®ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚µãƒ¼ã®åˆ¸é¢ã®ãŸã‚ã€è¦ªå’Œæ€§ã‚ã‚Šã€‚</p>
          <span class="cta-link-icon mt-2">ã‚«ãƒ¼ãƒ‰è©³ç´° <i class="fa-solid fa-chevron-right text-[10px]"></i></span>
        </div>
      </a>
    </section>

    <div class="flex items-center justify-between mb-4 px-1">
      <h3 class="text-xl font-bold tracking-tight">é”äººã®æŠ•ç¨¿</h3>
      <a id="hook-help-link" href="#" class="text-[11px] font-bold text-blue-600 bg-blue-50 px-3 py-1.5 rounded-full border border-blue-100">
        <i class="fa-regular fa-circle-question mr-1"></i>ãƒ•ãƒƒã‚¯ãƒ»å¼•ãè¾¼ã¿ã¨ã¯ï¼Ÿ
      </a>
    </div>

    <div id="ranking-container" class="space-y-6"></div>

    <!-- âœ… ä¸€ç•ªä¸‹ï¼šæŠ•ç¨¿ / ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ -->
    <div class="mt-10 mb-10">
      <div class="grid grid-cols-2 gap-3">
        <a id="post-btn" href="#" class="btn-primary flex flex-col items-center justify-center py-4 gap-1 shadow-lg shadow-blue-200">
          <i class="fa-solid fa-pen-to-square text-lg"></i>
          <span class="text-sm">æŠ•ç¨¿</span>
        </a>
        <a id="survey-btn" href="#" class="card flex flex-col items-center justify-center py-4 gap-1 border-gray-200">
          <i class="fa-solid fa-clipboard-list text-lg text-gray-500"></i>
          <span class="text-sm font-bold">ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ</span>
        </a>
      </div>

      <div class="mt-3 px-1 space-y-1">
        <p class="text-[11px] text-gray-500">â€»é‹å–¶ä¸­ã«ãŠæ°—ã¥ãã®ç‚¹ãŒã‚ã‚Œã°ã€ã€ŒæŠ•ç¨¿ã€ã‹ã‚‰ãœã²å…±æœ‰ã—ã¦ãã ã•ã„ï¼ˆã„ã¤ã§ã‚‚OKï¼‰</p>
        <p class="text-[11px] text-gray-500">â€»ã”åˆ©ç”¨å¾Œã«ã€Œã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã€ã¸ã®ã”å›ç­”ã«ã”å”åŠ›ã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™</p>
      </div>
    </div>

  </main>

  <script>
    // ===============================
    // âœ… å†…å®¹ï¼šğŸ‘‡ã®ãƒšãƒ¼ã‚¸ã®æƒ…å ±ã‚’ã€Œå¤±ã‚ãšã€ä¿æŒ
    // ===============================
    let posts = [
      {
        id: 1,
        staff_name: "æ«»äº•ã•ã‚“",
        event_name: "ãƒãƒ¬ãƒ³ã‚¿ã‚¤ãƒ³",
        store_name: "æœ‰æ¥½ç”º",

        // ğŸ· å±æ€§ï¼šå®¢å±¤ï¼†çŠ¶æ³ï¼ˆğŸ‘†ã®UIã§ã¯æœ€ä¸Šæ®µãƒãƒƒãƒ—ã«è¡¨ç¤ºï¼‰
        tags: [
          "ç”·å¥³æ¯”6:4",
          "é«˜æ ¡ç”Ÿã€œ20ä»£ä¸­å¿ƒ",
          "40ä»£ãƒ»è¦ªå­é€£ã‚Œã‚‚ã„ã‚‹",
        ],

        // ğŸª ãƒ•ãƒƒã‚¯ï¼šçŸ­ã„â€œè¨€ã„å›ã—â€ã‚’ãƒãƒƒãƒ—åŒ–
        hook_words: [
          "ä»Šæ—¥3000å††è¶…ãˆã¦ã‚‹ã®ã§ä¼šå ´é™å®šãƒ»éå£²å“ãŒå½“ãŸã‚‹æŠ½é¸ä¼šã«å‚åŠ ã§ãã¾ã™ãŒã€ã‚¨ãƒã‚¹ã‚«ãƒ¼ãƒ‰ãŠæŒã¡ã§ã™ã‹ï¼Ÿ",
          "ã‚¨ãƒã‚¹ã‚«ãƒ¼ãƒ‰æŒã£ã¦ã„ã‚‹å‰æã§è©±ã™",
        ],

        // ğŸ“¢ å¼•ãè¾¼ã¿ï¼šé­…åŠ›ã®æ ¸ï¼ˆ=å¼•ãè¾¼ã¿ï¼‰ã‚’ãƒãƒƒãƒ—åŒ–
        pitch_words: [
        "é«˜æ ¡å’æ¥­ã€18æ­³ä»¥ä¸Šã‚’ç¢ºã‹ã‚ã‚‹",
          "ã‚¹ãƒãƒ›å…¥ä¼šã§3000å††å‰²å¼•ã§å…¥å ´æ–™åˆ†ãŒå®Ÿè³ªå‰²å¼•",
          "æŠ½é¸ä¼šBè³ãƒ–ãƒ­ãƒã‚¤ãƒ‰8æšã‚³ãƒ³ãƒ—ã‚»ãƒƒãƒˆã‚’ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ",
          
        ],

        // ğŸ§¾ ã‚«ãƒ¼ãƒ‰èª¬æ˜ï¼šãƒãƒƒãƒ—ï¼ˆğŸ‘‡ã®å†…å®¹ã«ã‚ã£ãŸã€Œæ™‚é–“ãªã„æ–¹ã«ã¯ç„¡ç†ã«å‹§ã‚ãªã„ã€ã‚’è¿½åŠ ï¼‰
        card_words: [
          "ãƒãƒ«ã‚¤ã¯å¹´é–“300ã‚¿ã‚¤ãƒˆãƒ«ä»¥ä¸Šã‚¤ãƒ™ãƒ³ãƒˆé–‹å‚¬",
          "æ¬¡å›ä»¥é™ã‚‚æŠ½é¸ãƒ»ç‰¹å…¸ãƒ¡ãƒªãƒƒãƒˆã‚ã‚Š",
          "æ‰€è¦ç´„20åˆ†",
        ],

        hook_content:
`ã€ãƒ•ãƒƒã‚¯ã€‘
ãƒ»3000å††ä»¥ä¸Šè²·ã†æ–¹ãŒå¤šã„ã®ã§
ã€DECO27ã®ã‚¤ãƒ™ãƒ³ãƒˆã¯ä»Šå›ã§2å›ç›®ãªã‚“ã§ã™ãŒã€ä»Šæ—¥ãŠä¼šè¨ˆ3000å††è¶…ãˆã‚‹ã®ã§ä¼šå ´é™å®šã®éå£²å“ãŒå½“ãŸã‚‹æŠ½é¸ä¼šãŒã“ã®å¾Œå‡ºæ¥ã‚‹æ¨©åˆ©ãŒã‚ã‚‹ã‚“ã§ã™ãŒã€ã‚¨ãƒã‚¹ã‚«ãƒ¼ãƒ‰ä»Šæ—¥æŒã£ã¦æ¥ã¾ã—ãŸã‹ï¼Ÿã€ã¨ã€æŒã£ã¦ã„ã‚‹ç¨‹ã§ãŠè©±ã—ã¾ã™ã€‚
éå»ã«ã‚‚ã‚¤ãƒ™ãƒ³ãƒˆé–‹å‚¬ã—ã¦ã‚‹äº‹ã‚„æŠ½é¸ä¼šãƒ»ä¼šå ´é™å®šãƒ»éå£²å“ãªã©ã®è¨€è‘‰ã‚’ä½¿ã†ã¨ãŠå®¢æ§˜ã‚‚è©±ã‚’èã„ã¦ãã‚Œã‚‹å¯èƒ½æ€§ãŒé«˜ããªã‚Šã¾ã™ã€‚`,

        pitch_content:
`ã€å¼•ãè¾¼ã¿ã€‘
ã¯ã˜ã‚ã®èãæ–¹ã§ãŠå®¢æ§˜ãŒæŒã£ã¦ã„ãªã„ã¨åˆ†ã‹ã£ãŸã‚‰18æ­³ä»¥ä¸Šé«˜æ ¡å’æ¥­ã•ã‚Œã¦ã„ã‚‹äº‹ã‚’ç¢ºèªã—ã¦ã‹ã‚‰
ã€ä»Šå›ã“ã®ã‚¤ãƒ™ãƒ³ãƒˆã«åˆã‚ã›ã¦ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã‚’ã‚„ã£ã¦ã„ã¦ã€ã‚¹ãƒãƒ›ã‹ã‚‰ç„¡æ–™ã§å…¥ä¼šã—ã¦é ‚ãã¨å…¥å ´æ–™åˆ†ã‚’ã“ã¡ã‚‰ã®ãŠä¼šè¨ˆã‹ã‚‰3000å††å‰²å¼•ãã•ã›ã¦é ‚ãã®ã¨ã€æŠ½é¸ä¼šã®ï¼¢è³ã®ãƒ–ãƒ­ãƒã‚¤ãƒ‰8æšã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆã‚»ãƒƒãƒˆã‚’ä¼šå ´ã§ä½œã£ã¦é ‚ã„ãŸæ–¹ã«æŠ½é¸ä¼šå‰ã«ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã—ã¦ã‚‹ã®ã§ä½œã£ã¦ã‹ã‚‰ãŠä¼šè¨ˆã—ã¾ã›ã‚“ã‹ï¼Ÿã€ã¨ã•ã‚‰ã«æ„Ÿå¿ƒã‚’é«˜ã‚ã¾ã™ã€‚`,

        card_content:
`ã€ã‚«ãƒ¼ãƒ‰èª¬æ˜ã€‘
ã€VISAã®ä»˜ã„ãŸãƒãƒ«ã‚¤ã‚°ãƒ«ãƒ¼ãƒ—ãŒç™ºè¡Œã—ã¦ã„ã‚‹ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ã§å…¥ä¼šé‡‘ãƒ»å¹´ä¼šè²»ã‚„æ›´æ–°è²»ãªã©ä¸€åˆ‡ã‹ã‹ã‚‰ãªã„ã®ã§å®‰å¿ƒã—ã¦ãŠç”³ã—è¾¼ã¿å‡ºæ¥ã¾ã™ã€ã€Œã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆã‚„ã‚¢ãƒ‹ãƒ¡ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒãƒ«ã‚¤ã¯å¹´é–“ã§300ã‚¿ã‚¤ãƒˆãƒ«ä»¥ä¸Šã‚„ã£ã¦ã„ã‚‹ã®ã§ã‚«ãƒ¼ãƒ‰æŒã£ã¦ã„ã‚‹ã¨ã¾ãŸæ¬¡å›ã®ã‚¤ãƒ™ãƒ³ãƒˆã®æ™‚ã«ã”æç¤ºã—ã¦ç¾é‡‘æ‰•ã„ã§ã‚‚æŠ½é¸å‡ºæ¥ãŸã‚Šç‰¹å…¸å¤šãã‚‚ã‚‰ã£ãŸã‚Šå‡ºæ¥ã‚‹ã®ã§ä»Šæ—¥ä½œã£ãŸã‚«ãƒ¼ãƒ‰æ‰•ã„ã§ã“ã®å ´ã§3000å††å¼•ãã§â—‹â—‹â—‹å††ã§ãŠå¾—ã«ãŠè²·ã„ç‰©ã—ã¦ã„ãã¾ã›ã‚“ã‹ï¼Ÿã€
â€»ã“ã“ã§ä½œã‚Šã¾ã™ã¨ãªã£ãŸã‚‰ãŠæ™‚é–“20åˆ†ãã‚‰ã„å¤§ä¸ˆå¤«ã§ã™ã‹ï¼Ÿã‚„å…è¨±ã‚„ãƒã‚¤ãƒŠãƒ³ãƒãƒ¼ãªã©ãŠåå‰å…¥ã£ã¦ã‚‹ç‰©ãŠæŒã¡ã§ã™ã‹ï¼Ÿã‚„ä»Šæ—¥ã‚«ãƒ¼ãƒ‰ãŒä½œã‚ŒãŸã‚‰ãã®ã‚«ãƒ¼ãƒ‰ã§ãŠæ”¯æ‰•ã„ã—ã¦ä¸‹ã•ã„ã­ã€‚ãªã©ç¢ºèªã—ã¦ã”æ¡ˆå†…ã—ã¾ã™ã€‚
â€»ã“ã“ã¾ã§ãŠè©±ã—ã—ã¦æ–­ã£ãŸã‚Šã€ãŠæ™‚é–“ãªã„æ–¹ã«ã¯ç„¡ç†ãŠã™ã™ã‚ã›ãšã€ã˜ã‚ƒã€ã¾ãŸã®æ©Ÿä¼šã«ãŠé¡˜ã„ã—ã¾ã™ã­ã€ã¨ã•ã£ã•ã¨ç²¾ç®—ã—ã¾ã™ã€‚`,

        memo_content:
`ã€è£œè¶³ãƒ¡ãƒ¢ã€‘
â–ªï¸å®¢å±¤
ç”·å¥³æ¯”6:4  é«˜æ ¡ç”Ÿã€œ20ä»£ä¸­å¿ƒã§
40ä»£ã‚„è¦ªå­é€£ã‚Œã‚‚ã„ã‚‹ã€‚
ã‚¨ãƒã‚¹ã®ãƒ‡ã‚¶ã‚¤ãƒ³åˆ¸é¢ã§ã€Œãƒ”ãƒã‚­ã‚ªãƒ”ãƒ¼ã€ã¨ã„ã†åŒã˜ãƒœãƒ¼ã‚«ãƒ­ã‚¤ãƒ‰ã®ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚µãƒ¼ã®åˆ¸é¢ãŒè¦ªå’Œæ€§ãŒã‚ã‚Šã€ã‚«ãƒ¼ãƒ‰ã®ãŠã™ã™ã‚ã®éš›ã«è¦‹ã›ã‚‹ã¨ãã®åˆ¸é¢ã§ãŠç”³ã—è¾¼ã¿ã™ã‚‹æ–¹ãŒå¤šã„ã€‚å‰å›ã‚‚ãã®åˆ¸é¢ãŒäººæ°—ã§ã—ãŸã€‚
`,

        likes: 18,
        helpful: 0
      }
    ];

    // ===============================
    // UIè£œåŠ©
    // ===============================
    function escapeHtml(str) {
      return String(str).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m]));
    }

    function renderRanking() {
      const container = document.getElementById('ranking-container');
      if (!container) return;
      container.innerHTML = '';

      // ğŸ‘‡ã®ãƒšãƒ¼ã‚¸ã®ã€Œlikesã§ä¸¦ã¹æ›¿ãˆã€ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä¿æŒ
      const sorted = [...posts].sort((a, b) => (b.likes || 0) - (a.likes || 0));

      sorted.forEach((p, idx) => {
        const medal = idx === 0 ? 'ğŸ¥‡' : idx === 1 ? 'ğŸ¥ˆ' : idx === 2 ? 'ğŸ¥‰' : 'ğŸ“„';
        const card = document.createElement('div');
        card.className = "card p-5";

card.innerHTML = `
  <div class="flex justify-between items-start mb-5 gap-3">
    <div class="min-w-0">
      <span class="text-[10px] font-bold text-blue-600 bg-blue-50 px-2 py-0.5 rounded-md uppercase tracking-wider">${escapeHtml(p.event_name)}</span>
      <h4 class="text-lg font-bold mt-1 truncate">${medal} ${escapeHtml(p.staff_name)} <span class="text-xs text-gray-400 font-normal">@${escapeHtml(p.store_name || "-")}</span></h4>
    </div>

    <button onclick="helpfulPost(${p.id})" class="helpful-pill shrink-0" aria-label="å½¹ã«ç«‹ã£ãŸ">
      <i class="fa-regular fa-thumbs-up text-sm text-gray-600"></i>
      <span class="text-xs font-bold text-gray-800">å½¹ã«ç«‹ã£ãŸ</span>
      <span class="text-xs font-bold text-gray-500">(${escapeHtml(p.helpful || 0)})</span>
    </button>
  </div>

  <div class="space-y-4">
    <div>
      <span class="label-caps">ğŸª ãƒ•ãƒƒã‚¯</span>
      <div class="flex flex-wrap gap-1.5">${(p.hook_words || []).map(w => `<span class="chip chip-hook">${escapeHtml(w)}</span>`).join('')}</div>
    </div>

    <div>
      <span class="label-caps">ğŸ“¢ å¼•ãè¾¼ã¿</span>
      <div class="flex flex-wrap gap-1.5">${(p.pitch_words || []).map(w => `<span class="chip chip-pitch">${escapeHtml(w)}</span>`).join('')}</div>
    </div>

    <div>
      <span class="label-caps">ğŸ§¾ ã‚«ãƒ¼ãƒ‰èª¬æ˜</span>
      <div class="flex flex-wrap gap-1.5">${(p.card_words || []).map(w => `<span class="chip chip-card">${escapeHtml(w)}</span>`).join('')}</div>
    </div>

    <!-- âœ… ã“ã“ã«å±æ€§ãƒãƒƒãƒ—ã‚’ç§»å‹•ï¼ˆã‚«ãƒ¼ãƒ‰èª¬æ˜ã®ä¸‹ï¼‰ -->
    <div class="pt-3 hairline">
      <span class="label-caps">ğŸ· å±æ€§</span>
      <div class="flex flex-wrap gap-1.5">
        ${(p.tags || []).map(t => `<span class="chip chip-attribute">${escapeHtml(t)}</span>`).join('')}
      </div>
    </div>
  </div>

  <details class="mt-6 pt-4 border-t border-gray-100">
    <summary class="summary-row flex justify-center items-center text-xs font-bold text-gray-600 cursor-pointer hover:text-gray-700">
      å…¨æ–‡ã‚’è¦‹ã‚‹ <i class="fa-solid fa-chevron-down ml-2 text-[11px] text-gray-500"></i>
    </summary>
    <div class="mt-4 space-y-4">
      <div class="bg-orange-50/50 p-4 rounded-xl text-sm leading-relaxed border border-orange-100/60">
        <p class="font-bold text-orange-500 text-[10px] uppercase mb-2">ãƒ•ãƒƒã‚¯å…¨æ–‡</p>
        <div class="whitespace-pre-wrap text-gray-700">${escapeHtml(p.hook_content || "")}</div>
      </div>
      <div class="bg-green-50/50 p-4 rounded-xl text-sm leading-relaxed border border-green-100/60">
        <p class="font-bold text-green-600 text-[10px] uppercase mb-2">å¼•ãè¾¼ã¿å…¨æ–‡</p>
        <div class="whitespace-pre-wrap text-gray-700">${escapeHtml(p.pitch_content || "")}</div>
      </div>
      <div class="bg-blue-50/50 p-4 rounded-xl text-sm leading-relaxed border border-blue-100/60">
        <p class="font-bold text-blue-600 text-[10px] uppercase mb-2">èª¬æ˜å…¨æ–‡</p>
        <div class="whitespace-pre-wrap text-gray-700">${escapeHtml(p.card_content || "")}</div>
      </div>
      <div class="bg-gray-100/50 p-4 rounded-xl text-sm leading-relaxed border border-gray-200/60">
        <p class="font-bold text-gray-500 text-[10px] uppercase mb-2">è£œè¶³ãƒ¡ãƒ¢</p>
        <div class="whitespace-pre-wrap text-gray-700">${escapeHtml(p.memo_content || "")}</div>
      </div>
    </div>
  </details>
`;


        container.appendChild(card);
      });
    }

    // ===============================
    // âœ… Supabaseï¼ˆğŸ‘‡ã®ãƒšãƒ¼ã‚¸ã®æ©Ÿèƒ½ã‚’ä¿æŒï¼‰
    // ===============================
    const SUPABASE_URL = "https://uwlpkdgcfzdhgiptasov.supabase.co";
    const SUPABASE_PUBLISHABLE_KEY = "sb_publishable_vKVE-SAFvXjq5fLHApnqFg_B5QbxJZq";
    const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY);

    async function ensureAnonSession() {
      const { data, error } = await supabaseClient.auth.getSession();
      if (error) throw error;
      if (data && data.session) return;

      const { error: signInError } = await supabaseClient.auth.signInAnonymously();
      if (signInError) throw signInError;
    }

    async function loadHelpfulCountsFromDB() {
      const ids = posts.map(p => p.id);
      const { data, error } = await supabaseClient
        .from("posts")
        .select("id, helpful_count")
        .in("id", ids);

      if (error) throw error;

      const map = new Map((data || []).map(row => [row.id, row.helpful_count]));
      posts.forEach(p => {
        const v = map.get(p.id);
        if (typeof v === "number") p.helpful = v;
      });
    }

    window.helpfulPost = async function(id) {
      try {
        await ensureAnonSession();

        const { data, error } = await supabaseClient
          .rpc("vote_helpful", { p_post_id: id });

        if (error) throw error;

        const post = posts.find(p => p.id === id);
        if (post) {
          post.helpful = typeof data === "number" ? data : (post.helpful || 0);
          renderRanking();
        }
      } catch (e) {
        console.error(e);
      }
    };

    // ===============================
    // âœ… è¿½åŠ ï¼šãƒªãƒ³ã‚¯ï¼ˆğŸ‘‡ã®ãƒšãƒ¼ã‚¸ã®URLæŒ‡å®šã‚’ä¿æŒï¼‰
    // ===============================
    const EVENT_URL = "https://www.0101.co.jp/086/event/detail.html?article_seq=138536&article_type=sto";
    const CARD_URL  = "https://www.eposcard.co.jp/gecard/ec00013/index.html";
    const POST_URL  = "https://docs.google.com/forms/d/e/1FAIpQLSfa6EyMh80b6_4QTshvMF2yimmQOcF9ovepP97dQoHW9-nmsw/viewform";
    const SURVEY_URL = "https://docs.google.com/forms/d/1P8QJ34C5Mt6PQq82GSrHhbm3K8mQK-gSNp33HA9at9k/edit";

    // ===============================
    // ã€Œãƒ•ãƒƒã‚¯ãƒ»å¼•ãè¾¼ã¿ã¨ã¯ï¼Ÿã€åˆ¥ã‚¿ãƒ–ï¼ˆğŸ‘‡ã®ãƒšãƒ¼ã‚¸ã®å†…å®¹ã‚’ä¿æŒï¼‰
    // ===============================
    const HOOK_HELP_HTML = `<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ãƒ•ãƒƒã‚¯ãƒ»å¼•ãè¾¼ã¿ã¨ã¯ï¼Ÿï½œã‚«ãƒ¼ãƒ‰ã”æ¡ˆå†…ã®æµã‚Œ</title>
  <script src="https://cdn.tailwindcss.com"><\/script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    body { background-color: #f8f9ff; color: #333; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
    .card-shadow { box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
    .accent-purple { background-color: #f3f0ff; border: 1px solid #e9e4ff; }
    @keyframes popIn { 0% { transform: scale(0.98); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
    .pop { animation: popIn 0.25s ease-out; }
    .back-btn{
      position: fixed;
      left: 16px;
      bottom: 16px;
      z-index: 9999;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 12px 14px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: rgba(255,255,255,0.92);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      box-shadow: 0 10px 24px rgba(0,0,0,0.10);
      font-weight: 800;
      font-size: 14px;
      color: #111827;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    .back-btn:active{ transform: translateY(1px); }
  </style>
</head>
<body class="p-4 pb-12">
  <div class="max-w-md mx-auto">
    <div class="sticky top-0 z-30 bg-[#f8f9ff]/90 backdrop-blur-sm pt-2 pb-4">
      <div class="bg-white rounded-2xl card-shadow border border-gray-100 p-5 pop">
        <div class="flex items-start justify-between gap-3">
          <div>
            <p class="text-[11px] font-bold text-gray-400 tracking-widest">èª¬æ˜ãƒšãƒ¼ã‚¸</p>
            <h1 class="text-2xl font-extrabold text-gray-800 leading-tight">ãƒ•ãƒƒã‚¯ãƒ»å¼•ãè¾¼ã¿ã¨ã¯ï¼Ÿ</h1>
            <p class="text-sm text-gray-500 mt-1">ã‚«ãƒ¼ãƒ‰ã‚’ã”æ¡ˆå†…ã™ã‚‹ã¨ãã®â€œè©±ã™é †ç•ªâ€</p>
          </div>
          <div class="w-11 h-11 rounded-2xl bg-purple-50 border border-purple-100 flex items-center justify-center">
            <i class="fa-solid fa-route text-purple-600"></i>
          </div>
        </div>
        <div class="mt-4 p-4 rounded-2xl accent-purple">
          <p class="text-sm font-bold text-gray-800">
            <span class="text-purple-600">ã“ã®é †ç•ª</span>ã§è©±ã™ã“ã¨ãŒã€ã¨ã£ã¦ã‚‚å¤§äº‹
          </p>
          <p class="text-xs text-gray-600 mt-1">
            ã€Œèˆˆå‘³ã‚’æŒã¤ â†’ æ°—ã«ãªã‚‹ â†’ ç´å¾—ã™ã‚‹ã€ã®æµã‚Œã‚’ä½œã‚Œã¾ã™ã€‚
          </p>
        </div>
      </div>
    </div>

    <div class="space-y-4">
      <div class="bg-white p-5 rounded-2xl card-shadow border border-gray-100 pop">
        <div class="flex items-center gap-2 font-bold text-gray-800">
          <i class="fa-solid fa-list-ol text-slate-500"></i>
          <h2 class="text-base">ã‚«ãƒ¼ãƒ‰ã”æ¡ˆå†…ã®ãªãŒã‚Œ</h2>
        </div>

        <div class="mt-4 space-y-3">
          <div class="flex items-start gap-3">
            <div class="shrink-0 w-9 h-9 rounded-xl bg-orange-50 border border-orange-100 flex items-center justify-center">
              <span class="text-sm font-extrabold text-orange-500">1</span>
            </div>
            <div class="flex-1">
              <p class="font-extrabold text-gray-800 flex items-center gap-2">
                <span>ãƒ•ãƒƒã‚¯</span>
                <span class="text-[10px] bg-orange-50 text-orange-600 px-2 py-0.5 rounded-full font-bold">é–¢å¿ƒã‚’æŒã¤ãã£ã‹ã‘</span>
              </p>
              <p class="text-sm text-gray-600 mt-1">ã¾ãšã¯ã€Œè©±ã‚’èãç†ç”±ã€ã‚’ä½œã‚‹ä¸€è¨€ã€‚</p>
            </div>
          </div>

          <div class="flex items-start gap-3">
            <div class="shrink-0 w-9 h-9 rounded-xl bg-green-50 border border-green-100 flex items-center justify-center">
              <span class="text-sm font-extrabold text-green-600">2</span>
            </div>
            <div class="flex-1">
              <p class="font-extrabold text-gray-800 flex items-center gap-2">
                <span>å¼•ãè¾¼ã¿</span>
                <span class="text-[10px] bg-green-50 text-green-700 px-2 py-0.5 rounded-full font-bold">æ°—ã«ãªã‚‹ç†ç”±ã‚’å‡ºã™</span>
              </p>
              <p class="text-sm text-gray-600 mt-1">ãŠå®¢æ§˜ã®é–¢å¿ƒã«åˆã‚ã›ãŸé­…åŠ›ã‚’ä¼ãˆã‚‹ã€‚</p>
            </div>
          </div>

          <div class="flex items-start gap-3">
            <div class="shrink-0 w-9 h-9 rounded-xl bg-slate-50 border border-slate-200 flex items-center justify-center">
              <span class="text-sm font-extrabold text-slate-700">3</span>
            </div>
            <div class="flex-1">
              <p class="font-extrabold text-gray-800 flex items-center gap-2">
                <span>ã‚¨ãƒã‚¹ã‚«ãƒ¼ãƒ‰èª¬æ˜</span>
                <span class="text-[10px] bg-slate-100 text-slate-700 px-2 py-0.5 rounded-full font-bold">æœ€å¾Œã«åŸºæœ¬</span>
              </p>
              <p class="text-sm text-gray-600 mt-1">å®‰å¿ƒã§ãã‚‹æƒ…å ±ã‚’ä¼ãˆã¦ã€ç”³è¾¼ã«ã¤ãªã’ã‚‹ã€‚</p>
            </div>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-2xl card-shadow border border-gray-100 overflow-hidden pop">
        <div class="p-5 border-b border-dashed border-gray-200">
          <div class="flex items-center gap-2 font-bold text-gray-800">
            <i class="fa-solid fa-lightbulb text-yellow-500"></i>
            <h2 class="text-base">ä¾‹ãˆã°ï¼ˆMGAã®å ´åˆï¼‰</h2>
          </div>
          <p class="text-xs text-gray-500 mt-1">â€œãƒ•ãƒƒã‚¯ â†’ å¼•ãè¾¼ã¿ â†’ èª¬æ˜â€ã®é †ã«è©±ã™ä¾‹</p>
        </div>

        <div class="p-5 space-y-3">
          <div class="p-4 bg-orange-50 rounded-2xl">
            <p class="text-[11px] font-bold text-orange-600 mb-2">ğŸª ãƒ•ãƒƒã‚¯</p>
            <p class="text-sm text-gray-800 font-bold">ã€ŒMGAã®ãƒ•ã‚¡ãƒ³ã‚¯ãƒ©ãƒ–å…¥ã£ã¦ã„ã¾ã™ï¼Ÿã€</p>
            <p class="text-xs text-gray-600 mt-2">ï¼ˆé–¢å¿ƒã‚’ã‚‚ã¤ãã£ã‹ã‘ï¼‰</p>
          </div>

          <div class="p-4 bg-green-50 rounded-2xl">
            <p class="text-[11px] font-bold text-green-700 mb-2">ğŸ“¢ å¼•ãè¾¼ã¿</p>
            <p class="text-sm text-gray-800 font-bold">ã€ŒMGAã®ã‚¨ãƒã‚¹ã‚«ãƒ¼ãƒ‰ãŒã‚ã‚‹ã‚“ã§ã™ãŒã€æœ¬æ—¥å…¥ä¼šã„ãŸã ãã¨ã€ãƒ•ã‚¡ãƒ³ã‚¯ãƒ©ãƒ–å¹´ä¼šè²»ãŒ500å††ã‚ªãƒ•ã«ãªã‚‹ã‚“ã§ã™ã‚ˆã€</p>
            <p class="text-sm text-gray-800 font-bold mt-2">ã€Œã•ã‚‰ã«ä»Šæ—¥å…¥ä¼šã„ãŸã ãã¨ä»Šã®ãŠä¼šè¨ˆã‹ã‚‰2000å††ã‚ªãƒ•ã«ãªã‚Šã¾ã™ã‚ˆã€</p>
          </div>

          <div class="p-4 bg-slate-50 rounded-2xl">
            <p class="text-[11px] font-bold text-slate-700 mb-2">ğŸ§¾ ã‚¨ãƒã‚¹ã‚«ãƒ¼ãƒ‰èª¬æ˜</p>
            <p class="text-sm text-gray-800 font-bold">ã€Œå…¥ä¼šè²»ãƒ»å¹´ä¼šè²»ãšã£ã¨ç„¡æ–™ã§ã™ã€</p>
            <p class="text-sm text-gray-800 font-bold mt-2">ã€Œã‚ˆã‹ã£ãŸã‚‰ä»Šæ—¥ãŠä½œã‚Šã—ã¾ã›ã‚“ã‹ï¼Ÿã€</p>
          </div>
        </div>
      </div>

      <div class="accent-purple p-5 rounded-3xl card-shadow pop">
        <div class="flex items-center gap-2 font-bold text-gray-800 text-sm">
          <i class="fa-solid fa-star text-purple-600"></i>
          <span>ãƒã‚¤ãƒ³ãƒˆ</span>
        </div>
        <ul class="mt-3 space-y-2 text-sm text-gray-700">
          <li class="flex gap-2"><span class="text-purple-600 font-extrabold">ãƒ»</span>ãƒ•ãƒƒã‚¯â†’å¼•ãè¾¼ã¿â†’ã‚«ãƒ¼ãƒ‰èª¬æ˜ã®é †ç•ªé€šã‚Šã«ã‚„ã£ã¦ã¿ã‚‹</li>
          <li class="flex gap-2"><span class="text-purple-600 font-extrabold">ãƒ»</span>ãƒã‚¤ãƒ³ãƒˆã«ãªã‚‹å˜èªã‚’è¦šãˆã¦è¨€ã„ã‚„ã™ã„è¨€ã„æ–¹ã«å¤‰ãˆã¦ã¿ã‚‹</li>
          <li class="flex gap-2"><span class="text-purple-600 font-extrabold">ãƒ»</span>åŸºæœ¬èª¬æ˜ã¯æœ€å¾Œï¼ˆå®‰å¿ƒã§èƒŒä¸­ã‚’æŠ¼ã™ï¼‰</li>
        </ul>
      </div>

      <div class="pb-10"></div>
    </div>
  </div>

  <button type="button" class="back-btn" onclick="window.close()" aria-label="å…ƒã®ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹">
    <i class="fa-solid fa-arrow-left text-gray-600"></i>
    æˆ»ã‚‹
  </button>
</body>
</html>`;

    function openHookHelpTab() {
      const blob = new Blob([HOOK_HELP_HTML], { type: 'text/html;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      window.open(url, '_blank');
      setTimeout(() => URL.revokeObjectURL(url), 30_000);
    }

    // ===============================
    // init
    // ===============================
    window.addEventListener('load', () => {
      // links
      const eventLink = document.getElementById('event-link');
      const cardLink  = document.getElementById('card-link');
      const postBtn   = document.getElementById('post-btn');
      const surveyBtn = document.getElementById('survey-btn');

      if (eventLink) eventLink.href = EVENT_URL;
      if (cardLink) cardLink.href = CARD_URL;

      if (postBtn)   { postBtn.href = POST_URL; postBtn.target="_blank"; postBtn.rel="noopener"; }
      if (surveyBtn) { surveyBtn.href = SURVEY_URL; surveyBtn.target="_blank"; surveyBtn.rel="noopener"; }

      const help = document.getElementById('hook-help-link');
      if (help) {
        help.addEventListener('click', (e) => {
          e.preventDefault();
          openHookHelpTab();
        });
      }
    });

    (async function init() {
      try {
        await ensureAnonSession();
        await loadHelpfulCountsFromDB();
      } catch (e) {
        console.error(e);
      } finally {
        renderRanking();
      }
    })();
  </script>
</body>
</html>


